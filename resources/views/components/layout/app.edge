<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="keywords" content="">
  <meta name="author" content="">
  <meta name="robots" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="CareBlast : Peduli kesemua kalangan masyrakat">
  <meta property="og:title" content="CareBlast : Peduli kesemua kalangan masyrakat">
  <meta property="og:description" content="CareBlast : Peduli kesemua kalangan masyrakat">
  <meta name="format-detection" content="telephone=no">

  <!-- PAGE TITLE HERE -->
  <title>{{ title }}</title>
  <!-- Form step -->
  <link href="{{ asset('vendor/jquery-smartwizard/dist/css/smart_wizard.min.css') }}" rel="stylesheet">
  <!-- FAVICONS ICON -->
  <link rel="shortcut icon" type="image/png" href="{{ asset('images/favicon.png') }}">
  <link href="{{ asset('vendor/jquery-nice-select/css/nice-select.css') }}" rel="stylesheet">
  <link href="{{ asset('vendor/owl-carousel/owl.carousel.css') }}" rel="stylesheet">
  <!-- Daterange picker -->
  <link href="{{ asset('vendor/bootstrap-daterangepicker/daterangepicker.css') }}" rel="stylesheet">
  <!-- Clockpicker -->
  <link href="{{ asset('vendor/clockpicker/css/bootstrap-clockpicker.min.css') }}" rel="stylesheet">
  <!-- asColorpicker -->
  <link href="{{ asset('vendor/jquery-asColorPicker/css/asColorPicker.min.css') }}" rel="stylesheet">
  <!-- Material color picker -->
  <link href="{{ asset('vendor/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.css') }}"
    rel="stylesheet">
  <!-- Pick date -->
  <link rel="stylesheet" href="{{ asset('vendor/pickadate/themes/default.css') }}">
  <link rel="stylesheet" href="{{ asset('vendor/pickadate/themes/default.date.css') }}">
  <link href="{{ asset('../icon.css?family=Material+Icons') }}" rel="stylesheet">
  <!-- Sweet Alert -->
  <link href="{{ asset('vendor/sweetalert2/dist/sweetalert2.min.css') }}" rel="stylesheet">
  <!-- Style css -->
  <link href="{{ asset('css/style.css') }}" rel="stylesheet">
  {{-- qr code configuration --}}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.2/axios.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <!-- Toastr -->
  <link rel="stylesheet" href="vendor/toastr/css/toastr.min.css">

  @stack('styles')
</head>

<body>

  <!--*******************
        Preloader start
    ********************-->
  <div id="preloader">
    <div class="lds-ripple">
      <div></div>
      <div></div>
    </div>
  </div>

  <!--**********************************
        Main wrapper start
    ***********************************-->
  <div id="main-wrapper">
    @include('components/partials/header')
    @include('components/partials/sidebar')
    <div class="content-body">
      {{{ await $slots.content() }}}
    </div>
    @include('components/partials/footer')
  </div>

  <!--**********************************
        Scripts
    ***********************************-->
  <!-- Required vendors -->
  <script src="{{ asset('vendor/global/global.min.js') }}"></script>
  <script src="{{ asset('vendor/chart.js/Chart.bundle.min.js') }}"></script>
  <script src="{{ asset('vendor/jquery-nice-select/js/jquery.nice-select.min.js') }}"></script>

  <!-- Apex Chart -->
  <script src="{{ asset('vendor/apexchart/apexchart.js') }}"></script>

  <script src="{{ asset('vendor/chart.js/Chart.bundle.min.js') }}"></script>

  <!-- Chart piety plugin files -->
  <script src="{{ asset('vendor/peity/jquery.peity.min.js') }}"></script>
  <!-- Dashboard 1 -->
  <script src="{{ asset('js/dashboard/dashboard-1.js') }}"></script>
  <script src="{{ asset('vendor/owl-carousel/owl.carousel.js') }}"></script>

  <!-- Sweet Alert -->
  <script src="{{ asset('vendor/sweetalert2/dist/sweetalert2.min.js') }}"></script>
  <script src="{{ asset('js/plugins-init/sweetalert.init.js') }}"></script>

  <!-- Form Steps -->
  <script src="{{ asset('vendor/jquery-smartwizard/dist/js/jquery.smartWizard.js') }}"></script>
  <script src="{{ asset('vendor/jquery-nice-select/js/jquery.nice-select.min.js') }}"></script>

  <script src="{{ asset('js/custom.min.js') }}"></script>
  <script src="{{ asset('js/dlabnav-init.js') }}"></script>
  <script src="{{ asset('js/demo.js') }}"></script>
  <script src="{{ asset('js/styleSwitcher.js') }}"></script>

  <!-- Daterangepicker -->
  <!-- momment js is must -->
  <script src="{{ asset('vendor/moment/moment.min.js') }}"></script>
  <script src="{{ asset('vendor/bootstrap-daterangepicker/daterangepicker.js') }}"></script>
  <!-- clockpicker -->
  <script src="{{ asset('vendor/clockpicker/js/bootstrap-clockpicker.min.js') }}"></script>
  <!-- asColorPicker -->
  <script src="{{ asset('vendor/jquery-asColor/jquery-asColor.min.js') }}"></script>
  <script src="{{ asset('vendor/jquery-asGradient/jquery-asGradient.min.js') }}"></script>
  <script src="{{ asset('vendor/jquery-asColorPicker/js/jquery-asColorPicker.min.js') }}"></script>
  <!-- Material color picker -->
  <script
    src="{{ asset('vendor/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.js') }}"></script>
  <!-- pickdate -->
  <script src="{{ asset('vendor/pickadate/picker.js') }}"></script>
  <script src="{{ asset('vendor/pickadate/picker.time.js') }}"></script>
  <script src="{{ asset('vendor/pickadate/picker.date.js') }}"></script>
  <!-- Daterangepicker -->
  <script src="{{ asset('js/plugins-init/bs-daterange-picker-init.js') }}"></script>
  <!-- Clockpicker init -->
  <script src="{{ asset('js/plugins-init/clock-picker-init.js') }}"></script>
  <!-- asColorPicker init -->
  <script src="{{ asset('js/plugins-init/jquery-asColorPicker.init.js') }}"></script>
  <!-- Material color picker init -->
  <script src="{{ asset('js/plugins-init/material-date-picker-init.js') }}"></script>
  <!-- Pickdate -->
  <script src="{{ asset('js/plugins-init/pickadate-init.js') }}"></script>
  <script src="{{ asset('vendor/ckeditor/ckeditor.js') }}"></script>
  {{-- toast --}}
  <script src="vendor/toastr/js/toastr.min.js"></script>
  {{-- qr code configuration --}}
  <script>
    async function loadQRCode() {
      try {
        const response = await axios.get('/qrcode');
        const qrCodeImg = document.getElementById('qrCode');
        const statusDiv = document.getElementById('status');
        const logoutBtn = document.getElementById('logoutBtn');

        if (response.data.status === 'success') {
          if (response.data.qrCode === 'You are already logged in') {
            qrCodeImg.style.display = 'none';
            statusDiv.className = 'alert alert-success text-center fs-15 mb-4';
            statusDiv.textContent = 'You are already connected to WhatsApp!';
            logoutBtn.style.display = 'block';
          } else {
            qrCodeImg.src = `data:image/png;base64,${response.data.qrCode}`;
            qrCodeImg.style.display = 'block';
            statusDiv.className = 'alert alert-info text-center fs-15 mb-4';
            statusDiv.textContent = 'Waiting for connection...';
            checkStatus();
          }
        }
      } catch (error) {
        console.error('Error loading QR code:', error);
        const statusDiv = document.getElementById('status');
        statusDiv.className = 'alert alert-danger text-center fs-15 mb-4';
        statusDiv.textContent = 'Failed to load QR code. Please try again.';
      }
    }

    async function checkStatus() {
      try {
        const response = await axios.get('/status');
        const qrCodeImg = document.getElementById('qrCode');
        const statusDiv = document.getElementById('status');
        const logoutBtn = document.getElementById('logoutBtn');

        if (response.data.status === 'success') {
          if (response.data.connected) {
            qrCodeImg.style.display = 'none';
            statusDiv.className = 'alert alert-success text-center fs-15 mb-4';
            statusDiv.textContent = 'Connected to WhatsApp!';
            logoutBtn.style.display = 'block';
          } else {
            statusDiv.className = 'alert alert-info text-center fs-15 mb-4';
            statusDiv.textContent = 'Waiting for connection...';
            logoutBtn.style.display = 'none';
            setTimeout(checkStatus, 5000);
          }
        }
      } catch (error) {
        console.error('Error checking status:', error);
      }
    }

    function refreshQR() {
      document.getElementById('qrCode').style.display = 'block';
      document.getElementById('logoutBtn').style.display = 'none';
      document.getElementById('status').className = 'alert alert-info text-center fs-15 mb-4';
      document.getElementById('status').textContent = 'Waiting for connection...';
      loadQRCode();
    }

    async function logout() {
      const logoutBtn = document.getElementById('logoutBtn');
      const originalText = logoutBtn.textContent || 'Logout';

      try {
        logoutBtn.innerHTML = '<span class="loading"></span>Logging out...';
        logoutBtn.disabled = true;

        const response = await axios.post('/logout');
        if (response.data.status === 'success') {
          const statusDiv = document.getElementById('status');
          statusDiv.className = 'alert alert-warning text-center fs-15 mb-4';
          statusDiv.textContent = 'Logged out successfully.';
          document.getElementById('qrCode').style.display = 'block';
          logoutBtn.style.display = 'none';
          setTimeout(loadQRCode, 1000);
        } else {
          throw new Error(response.data.message || 'Logout failed');
        }
      } catch (error) {
        console.error('Error during logout:', error);
        const statusDiv = document.getElementById('status');
        statusDiv.className = 'alert alert-danger text-center fs-15 mb-4';
        statusDiv.textContent = 'Logout failed. Please try again.';
      } finally {
        logoutBtn.innerHTML = originalText;
        logoutBtn.disabled = false;
      }
    }

    // Initial load
    loadQRCode();
  </script>

  <script>
    $(document).ready(function () {
      // SmartWizard initialize
      $('#smartwizard').smartWizard();
    });
  </script>
  <script>
    function cardsCenter() {

      /*  testimonial one function by = owl.carousel.js */
      jQuery('.card-slider').owlCarousel({
        loop: true,
        margin: 0,
        nav: true,
        //center:true,
        slideSpeed: 3000,
        paginationSpeed: 3000,
        dots: true,
        navText: ['<i class="fas fa-arrow-left"></i>', '<i class="fas fa-arrow-right"></i>'],
        responsive: {
          0: {
            items: 1
          },
          576: {
            items: 1
          },
          800: {
            items: 1
          },
          991: {
            items: 1
          },
          1200: {
            items: 1
          },
          1600: {
            items: 1
          }
        }
      })
    }

    jQuery(window).on('load', function () {
      setTimeout(function () {
        cardsCenter();
      }, 1000);
    });

  </script>

  @stack('scripts')

</body>

</html>